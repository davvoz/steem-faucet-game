import{a as L,d as Q,f as G,l as H}from"./chunk-UBI7QNDD.js";import{B,C as U,D as q,F as J,M as K,N as X,z as W}from"./chunk-KHIBII34.js";import{A as p,G as C,Ia as s,J as b,Ma as E,Qa as w,T as v,Ua as z,V as S,Vb as N,Y as y,Zb as V,_a as a,ba as M,ca as A,cb as I,db as x,eb as O,fb as c,gb as i,ka as R,kb as F,la as k,lb as g,mb as P,rb as l,sb as $,tb as h,ub as T,v as _,vb as D,w as d,wb as j}from"./chunk-PFR3DRAX.js";var u=class o{constructor(e,t){this.firestore=e;this.notificationService=t}resetCollections(e){if(!e||e.length===0)return d(["No collections specified for reset"]);let t=e.map(n=>this.deleteAllDocumentsInCollection(n));return C(t).pipe(S(n=>{let r=`Database tables reset successfully: ${e.join(", ")}`;this.notificationService.success(r)}),b(n=>{let r=`Error resetting database: ${n.message}`;return this.notificationService.error(r),d([r])}))}deleteAllDocumentsInCollection(e){let t=B(this.firestore,e);return _(J(t)).pipe(v(n=>{if(n.empty)return d(`Collection ${e} is already empty`);let r=n.docs.map(m=>{let Y=q(this.firestore,`${e}/${m.id}`);return _(U(Y))});return C(r).pipe(p(()=>`Deleted ${n.size} documents from ${e}`))}),b(n=>(console.error(`Error deleting collection ${e}:`,n),d(`Error deleting collection ${e}: ${n.message}`))))}static \u0275fac=function(t){return new(t||o)(M(W),M(X))};static \u0275prov=y({token:o,factory:o.\u0275fac,providedIn:"root"})};var te=(o,e)=>e.name;function ne(o,e){if(o&1){let t=F();c(0,"div",8)(1,"label")(2,"input",12),j("ngModelChange",function(r){let m=R(t).$implicit;return D(m.selected,r)||(m.selected=r),k(r)}),i(),l(3),i()()}if(o&2){let t=e.$implicit,n=P();s(2),T("ngModel",t.selected),a("disabled",n.isResetting),s(),h(" ",t.name," ")}}function oe(o,e){if(o&1&&(c(0,"li"),l(1),i()),o&2){let t=e.$implicit;s(),$(t)}}function ie(o,e){if(o&1&&(c(0,"div",13)(1,"h3"),l(2,"Risultati:"),i(),c(3,"ul"),x(4,oe,2,1,"li",null,I),i()()),o&2){let t=P();s(4),O(t.resetResults)}}var f=class o{constructor(e){this.adminService=e}collections=[{name:"game_results",selected:!1},{name:"faucet_claims",selected:!1},{name:"games",selected:!1},{name:"leaderboard",selected:!1},{name:"users",selected:!1}];isResetting=!1;resetResults=[];resetSelected(){let e=this.collections.filter(t=>t.selected).map(t=>t.name);if(e.length===0){this.resetResults=["Seleziona almeno una tabella da resettare"];return}this.isResetting=!0,this.resetResults=[`Operazione di reset iniziata per: ${e.join(", ")}`],this.adminService.resetCollections(e).subscribe({next:t=>{this.resetResults=t,this.isResetting=!1},error:t=>{this.resetResults=[`Errore durante il reset: ${t.message}`],this.isResetting=!1}})}toggleAll(e){this.collections.forEach(t=>t.selected=e)}hasSelectedCollections(){return this.collections.some(e=>e.selected)}static \u0275fac=function(t){return new(t||o)(E(u))};static \u0275cmp=w({type:o,selectors:[["app-admin"]],decls:26,vars:5,consts:[[1,"admin-container"],[1,"reset-section"],[1,"warning"],[1,"collections-container"],[1,"collections-header"],[1,"select-actions"],[3,"click","disabled"],[1,"collections-list"],[1,"collection-item"],[1,"actions"],[1,"reset-button",3,"click","disabled"],["class","results",4,"ngIf"],["type","checkbox",3,"ngModelChange","ngModel","disabled"],[1,"results"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"h1"),l(2,"Pannello Amministrativo"),i(),c(3,"section",1)(4,"h2"),l(5,"Reset Tabelle Database"),i(),c(6,"p",2)(7,"strong"),l(8,"Attenzione:"),i(),l(9," Il reset delle tabelle eliminer\xE0 permanentemente tutti i dati nelle collezioni selezionate. Questa operazione non pu\xF2 essere annullata. "),i(),c(10,"div",3)(11,"div",4)(12,"h3"),l(13,"Seleziona le tabelle da resettare:"),i(),c(14,"div",5)(15,"button",6),g("click",function(){return n.toggleAll(!0)}),l(16,"Seleziona tutti"),i(),c(17,"button",6),g("click",function(){return n.toggleAll(!1)}),l(18,"Deseleziona tutti"),i()()(),c(19,"div",7),x(20,ne,4,3,"div",8,te),i()(),c(22,"div",9)(23,"button",10),g("click",function(){return n.resetSelected()}),l(24),i()(),z(25,ie,6,0,"div",11),i()()),t&2&&(s(15),a("disabled",n.isResetting),s(2),a("disabled",n.isResetting),s(3),O(n.collections),s(3),a("disabled",n.isResetting||!n.hasSelectedCollections()),s(),h(" ",n.isResetting?"Reset in corso...":"Reset Tabelle Selezionate"," "),s(),a("ngIf",n.resetResults.length>0))},dependencies:[V,N,H,L,Q,G],styles:[".admin-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px}.admin-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#2c3e50;border-bottom:2px solid #3498db;padding-bottom:10px;margin-bottom:30px}.reset-section[_ngcontent-%COMP%]{background-color:#f8f9fa;border-radius:8px;padding:20px;box-shadow:0 2px 10px #0000001a}.reset-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2c3e50;margin-top:0}.reset-section[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{background-color:#fff3cd;color:#856404;padding:12px;border-radius:4px;border-left:4px solid #ffc107;margin-bottom:20px}.collections-container[_ngcontent-%COMP%]{margin:20px 0}.collections-container[_ngcontent-%COMP%]   .collections-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.collections-container[_ngcontent-%COMP%]   .collections-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.collections-container[_ngcontent-%COMP%]   .collections-header[_ngcontent-%COMP%]   .select-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #ced4da;border-radius:4px;padding:5px 10px;margin-left:10px;cursor:pointer;font-size:.9rem}.collections-container[_ngcontent-%COMP%]   .collections-header[_ngcontent-%COMP%]   .select-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.collections-container[_ngcontent-%COMP%]   .collections-header[_ngcontent-%COMP%]   .select-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.collections-container[_ngcontent-%COMP%]   .collections-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}.collections-container[_ngcontent-%COMP%]   .collections-list[_ngcontent-%COMP%]   .collection-item[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #dee2e6;border-radius:4px;padding:10px}.collections-container[_ngcontent-%COMP%]   .collections-list[_ngcontent-%COMP%]   .collection-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer}.collections-container[_ngcontent-%COMP%]   .collections-list[_ngcontent-%COMP%]   .collection-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px}.actions[_ngcontent-%COMP%]{margin-top:20px}.actions[_ngcontent-%COMP%]   .reset-button[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;border-radius:4px;padding:10px 20px;font-size:1rem;cursor:pointer;transition:background-color .3s}.actions[_ngcontent-%COMP%]   .reset-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#c82333}.actions[_ngcontent-%COMP%]   .reset-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.results[_ngcontent-%COMP%]{margin-top:30px}.results[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;border-bottom:1px solid #dee2e6;padding-bottom:5px}.results[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:20px}.results[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:5px}"]})};var ve=[{path:"",component:f,canActivate:[()=>A(K).currentUser$.pipe(p(e=>e&&e.isAdmin===!0))],title:"Pannello Amministrativo"}];export{ve as ADMIN_ROUTES};
